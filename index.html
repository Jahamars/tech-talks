<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tech Talks — Jahongir Ahmadaliev</title>
  <meta name="description" content="Tech talks and presentations by Jahongir Ahmadaliev">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Science+Gothic&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.6/marked.min.js"></script>
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg:       #2C2C2C;
      --surface:  #383838;
      --border:   #444444;
      --border-h: #606060;
      --text:     #F0F0F0;
      --muted:    #888888;
      --r:        5px;
    }

    html, body { overflow-x: hidden; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Science Gothic', 'Segoe UI', system-ui, sans-serif;
      font-optical-sizing: auto;
      font-variation-settings: "slnt" 0, "wdth" 100, "CTRS" 0;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
      line-height: 1.5;
    }

    .page {
      max-width: 860px;
      margin: 0 auto;
      padding: 3rem 2rem 6rem;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      padding-bottom: 1.5rem;
      border-bottom: 1px solid var(--border);
      margin-bottom: 5rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .logo {
      font-size: 0.88rem;
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--text);
      text-decoration: none;
    }

    nav { display: flex; gap: 2rem; flex-wrap: wrap; }

    nav a {
      font-size: 0.75rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--muted);
      text-decoration: none;
      transition: color 0.15s;
    }

    nav a:hover { color: var(--text); }

    .hero { margin-bottom: 2.5rem; }

    h1 {
      font-size: 2.4rem;
      font-weight: 700;
      line-height: 1.1;
      margin-bottom: 0.4rem;
      font-variation-settings: "slnt" 0, "wdth" 110, "CTRS" 0;
    }

    .sub {
      font-size: 0.8rem;
      color: var(--muted);
      letter-spacing: 0.04em;
    }

    /* list */
    .list {
      border: 1px solid var(--border);
      border-radius: var(--r);
      overflow: hidden;
    }

    .item {
      display: grid;
      grid-template-columns: 72px 1fr 20px;
      align-items: center;
      gap: 1.5rem;
      padding: 1.1rem 1.4rem;
      border-bottom: 1px solid var(--border);
      background: transparent;
      cursor: pointer;
      transition: background 0.15s;
    }

    .item:last-child { border-bottom: none; }
    .item:hover { background: var(--surface); }
    .item:hover .arr { opacity: 1; transform: translateX(3px); }

    .date {
      font-size: 0.63rem;
      color: var(--muted);
      letter-spacing: 0.06em;
      text-transform: uppercase;
      font-weight: 600;
      white-space: nowrap;
    }

    .body { min-width: 0; }

    .ttitle {
      font-size: 0.87rem;
      font-weight: 600;
      line-height: 1.3;
      margin-bottom: 0.2rem;
    }

    .desc {
      font-size: 0.76rem;
      color: var(--muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .tags {
      display: flex;
      gap: 0.35rem;
      flex-wrap: wrap;
      margin-top: 0.4rem;
    }

    .tag {
      font-size: 0.6rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--muted);
      border: 1px solid var(--border);
      border-radius: var(--r);
      padding: 0.12rem 0.45rem;
    }

    .arr {
      font-size: 0.8rem;
      color: var(--muted);
      font-family: monospace;
      opacity: 0;
      transition: opacity 0.15s, transform 0.15s;
    }

    /* state */
    .state {
      padding: 2.5rem;
      text-align: center;
      color: var(--muted);
      font-size: 0.8rem;
      letter-spacing: 0.03em;
    }

    .state a { color: var(--muted); text-decoration: none; border-bottom: 1px solid var(--border); }
    .state a:hover { color: var(--text); }

    .spin {
      display: inline-block;
      width: 13px;
      height: 13px;
      border: 1.5px solid var(--border);
      border-top-color: var(--muted);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      vertical-align: middle;
      margin-right: 0.5rem;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    /* footer */
    footer {
      margin-top: 5rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      font-size: 0.72rem;
      color: var(--muted);
      letter-spacing: 0.04em;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    footer a { color: var(--muted); text-decoration: none; }
    footer a:hover { color: var(--text); }

    /* ── detail overlay ── */
    .detail {
      display: none;
      position: fixed;
      inset: 0;
      background: var(--bg);
      z-index: 100;
      overflow-y: auto;
    }

    .detail.open { display: block; }

    .detail-page {
      max-width: 780px;
      margin: 0 auto;
      padding: 3rem 2rem 6rem;
    }

    .back {
      display: inline-block;
      padding: 0.35rem 0.85rem;
      border: 1px solid var(--border);
      border-radius: var(--r);
      background: transparent;
      color: var(--muted);
      font-family: inherit;
      font-size: 0.72rem;
      letter-spacing: 0.07em;
      text-transform: uppercase;
      cursor: pointer;
      margin-bottom: 3rem;
      transition: color 0.15s, border-color 0.15s;
      font-variation-settings: "slnt" 0, "wdth" 100, "CTRS" 0;
    }

    .back:hover { color: var(--text); border-color: var(--border-h); }

    .d-date {
      font-size: 0.68rem;
      color: var(--muted);
      letter-spacing: 0.1em;
      text-transform: uppercase;
      margin-bottom: 0.5rem;
    }

    .d-title {
      font-size: 2rem;
      font-weight: 700;
      line-height: 1.2;
      margin-bottom: 0.6rem;
      font-variation-settings: "slnt" 0, "wdth" 110, "CTRS" 0;
    }

    .d-desc {
      font-size: 0.85rem;
      color: var(--muted);
      line-height: 1.7;
      margin-bottom: 1rem;
    }

    .d-tags {
      display: flex;
      gap: 0.35rem;
      flex-wrap: wrap;
      margin-bottom: 1.75rem;
    }

    .d-actions {
      display: flex;
      gap: 0.6rem;
      flex-wrap: wrap;
      padding-bottom: 2.5rem;
      margin-bottom: 2.5rem;
      border-bottom: 1px solid var(--border);
    }

    .btn {
      display: inline-block;
      padding: 0.4rem 1rem;
      border-radius: var(--r);
      font-family: inherit;
      font-size: 0.72rem;
      letter-spacing: 0.07em;
      text-transform: uppercase;
      text-decoration: none;
      cursor: pointer;
      border: none;
      transition: border-color 0.15s, color 0.15s;
      font-variation-settings: "slnt" 0, "wdth" 100, "CTRS" 0;
    }

    .btn-p {
      background: var(--surface);
      border: 1px solid var(--border-h);
      color: var(--text);
    }

    .btn-p:hover { border-color: var(--muted); }

    .btn-s {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--muted);
    }

    .btn-s:hover { color: var(--text); border-color: var(--border-h); }

    .readme-sep {
      font-size: 0.63rem;
      color: var(--muted);
      letter-spacing: 0.12em;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .readme-sep::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--border);
    }

    /* markdown */
    .md {
      font-size: 0.87rem;
      line-height: 1.8;
      color: #BBBBBB;
    }

    .md h1, .md h2, .md h3, .md h4 {
      font-family: inherit;
      color: var(--text);
      font-weight: 700;
      font-variation-settings: "slnt" 0, "wdth" 105, "CTRS" 0;
      margin: 2rem 0 0.6rem;
    }

    .md h1 { font-size: 1.2rem; }
    .md h2 { font-size: 1rem; }
    .md h3 { font-size: 0.9rem; }

    .md p { margin-bottom: 0.85rem; }

    .md a { color: var(--muted); text-underline-offset: 3px; }
    .md a:hover { color: var(--text); }

    .md code {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 3px;
      padding: 0.1em 0.4em;
      font-size: 0.83em;
      font-family: 'JetBrains Mono', 'Fira Code', monospace;
      color: var(--text);
    }

    .md pre {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--r);
      padding: 1.2rem;
      overflow-x: auto;
      margin: 1rem 0;
    }

    .md pre code { background: none; border: none; padding: 0; font-size: 0.82rem; }

    .md ul, .md ol { padding-left: 1.4rem; margin-bottom: 0.85rem; }
    .md li { margin-bottom: 0.25rem; }
    .md strong { color: var(--text); font-weight: 600; }

    .md blockquote {
      border-left: 2px solid var(--border);
      padding-left: 1rem;
      margin: 1rem 0;
      color: var(--muted);
    }

    .md hr { border: none; border-top: 1px solid var(--border); margin: 1.5rem 0; }

    .md table { width: 100%; border-collapse: collapse; margin: 1rem 0; font-size: 0.83rem; }
    .md th, .md td { border: 1px solid var(--border); padding: 0.45rem 0.7rem; text-align: left; }
    .md th { background: var(--surface); color: var(--text); font-weight: 600; }

    .md img { max-width: 100%; border-radius: var(--r); margin: 1rem 0; }

    /* mobile */
    @media (max-width: 580px) {
      .page, .detail-page { padding: 2rem 1.25rem 4rem; }
      header { margin-bottom: 3rem; }
      h1, .d-title { font-size: 1.75rem; }
      .item { grid-template-columns: 1fr; gap: 0.25rem; padding: 1rem; }
      .date { display: none; }
      .arr { display: none; }
      .desc { white-space: normal; }
    }
  </style>
</head>
<body>

<!-- list -->
<div class="page" id="list-view">
  <header>
    <a class="logo" href="https://jahongir.ru">Jahongir Ahmadaliev</a>
    <nav>
      <a href="https://jahongir.ru">Home</a>
      <a href="https://github.com/jahamars" target="_blank" rel="noopener">GitHub</a>
      <a href="https://t.me/gruvboxx" target="_blank" rel="noopener">Telegram</a>
    </nav>
  </header>

  <div class="hero">
    <h1>Tech Talks</h1>
    <p class="sub">Presentations, deep dives &amp; demos</p>
  </div>

  <div class="list" id="list"><div class="state"><span class="spin"></span>Loading...</div></div>

  <footer>
    <a href="https://jahongir.ru">jahongir.ru</a>
  </footer>
</div>

<!-- detail -->
<div class="detail" id="detail">
  <div class="detail-page">
    <button class="back" id="back">&lt;- Back</button>
    <div class="d-date"  id="d-date"></div>
    <div class="d-title" id="d-title"></div>
    <div class="d-desc"  id="d-desc"></div>
    <div class="d-tags"  id="d-tags"></div>
    <div class="d-actions" id="d-actions"></div>
    <div class="readme-sep">README</div>
    <div class="md" id="d-readme"><span class="spin"></span></div>
  </div>
</div>

<script>
// ── config ────────────────────────────────────────────────────────────
const OWNER  = 'Jahamars';
const REPO   = 'tech-talks';
const BRANCH = 'main';
const SKIP   = new Set(['LICENSE', 'README.md', 'index.html', '.github', '.git']);

const API = path =>
  `https://api.github.com/repos/${OWNER}/${REPO}/contents/${path}`;
const GH = path =>
  `https://github.com/${OWNER}/${REPO}/blob/${BRANCH}/${path}`;
const GH_TREE = path =>
  `https://github.com/${OWNER}/${REPO}/tree/${BRANCH}/${path}`;
// ─────────────────────────────────────────────────────────────────────

const listEl   = document.getElementById('list');
const listView = document.getElementById('list-view');
const detail   = document.getElementById('detail');

const label = s => s.replace(/[-_]/g, ' ').replace(/\b\w/g, c => c.toUpperCase());

function fmtDate(s) {
  if (!s) return '';
  const [y, m] = s.split('-');
  return new Date(y, (parseInt(m) || 1) - 1)
    .toLocaleDateString('en', { month: 'short', year: 'numeric' });
}

async function get(path) {
  const r = await fetch(API(path), { headers: { Accept: 'application/vnd.github.v3+json' } });
  if (!r.ok) throw new Error(r.status);
  return r.json();
}

async function load() {
  try {
    const root = await get('');
    const dirs = root.filter(f => f.type === 'dir' && !SKIP.has(f.name));

    const talks = await Promise.all(dirs.map(async d => {
      // try meta.json for rich data
      try {
        const r = await fetch(
          `https://raw.githubusercontent.com/${OWNER}/${REPO}/${BRANCH}/${d.name}/meta.json`
        );
        if (r.ok) {
          const m = await r.json();
          return { id: d.name, title: d.name, desc: '', tags: [], date: null, ...m };
        }
      } catch {}
      // fallback: use directory name
      return { id: d.name, title: label(d.name), desc: '', tags: [], date: null };
    }));

    // newest first
    talks.sort((a, b) => (b.date || '').localeCompare(a.date || ''));
    renderList(talks);
  } catch {
    listEl.innerHTML = `<div class="state">
      Could not load data.
      <a href="https://github.com/${OWNER}/${REPO}" target="_blank">View on GitHub</a>
    </div>`;
  }
}

function renderList(talks) {
  if (!talks.length) {
    listEl.innerHTML = '<div class="state">No talks yet.</div>';
    return;
  }

  listEl.innerHTML = '';
  talks.forEach(t => {
    const el = document.createElement('div');
    el.className = 'item';
    el.innerHTML = `
      <span class="date">${t.date ? fmtDate(t.date) : '-'}</span>
      <span class="body">
        <span class="ttitle">${t.title}</span>
        ${t.desc ? `<span class="desc">${t.desc}</span>` : ''}
        ${t.tags?.length ? `<span class="tags">${t.tags.map(x => `<span class="tag">${x}</span>`).join('')}</span>` : ''}
      </span>
      <span class="arr">-></span>
    `;
    el.addEventListener('click', () => openDetail(t));
    listEl.appendChild(el);
  });
}

async function openDetail(t) {
  // populate static fields
  document.getElementById('d-date').textContent  = t.date ? fmtDate(t.date) : '';
  document.getElementById('d-title').textContent = t.title;
  document.getElementById('d-desc').textContent  = t.desc || '';
  document.getElementById('d-tags').innerHTML    = t.tags?.length
    ? t.tags.map(x => `<span class="tag">${x}</span>`).join('') : '';
  document.getElementById('d-actions').innerHTML = '';
  document.getElementById('d-readme').innerHTML  = '<span class="spin"></span>';

  // show detail
  listView.style.display = 'none';
  detail.classList.add('open');
  detail.scrollTop = 0;

  // fetch directory contents (one API call)
  try {
    const files = await get(t.id);

    // PDF: search root and one level of subdirs
    let pdfPath = null;
    const rootPdf = files.find(f => f.type === 'file' && f.name.toLowerCase().endsWith('.pdf'));
    if (rootPdf) {
      pdfPath = `${t.id}/${rootPdf.name}`;
    } else {
      // look one subdir deep
      for (const sub of files.filter(f => f.type === 'dir')) {
        try {
          const sub_files = await get(`${t.id}/${sub.name}`);
          const pdf = sub_files.find(f => f.type === 'file' && f.name.toLowerCase().endsWith('.pdf'));
          if (pdf) { pdfPath = `${t.id}/${sub.name}/${pdf.name}`; break; }
        } catch {}
      }
    }

    document.getElementById('d-actions').innerHTML = `
      <a class="btn btn-p" href="${GH_TREE(t.id)}" target="_blank" rel="noopener">Source on GitHub</a>
      ${pdfPath ? `<a class="btn btn-s" href="${GH(pdfPath)}" target="_blank" rel="noopener">Slides PDF</a>` : ''}
    `;

    // README: use GitHub Contents API to get base64, avoids CORS on raw URLs
    const readmeFile = files.find(f => f.type === 'file' && f.name.toLowerCase() === 'readme.md');
    if (readmeFile) {
      const data = await get(`${t.id}/README.md`);
      const text = decodeURIComponent(
        Array.from(atob(data.content.replace(/\n/g, '')))
          .map(c => '%' + c.charCodeAt(0).toString(16).padStart(2, '0'))
          .join('')
      );
      document.getElementById('d-readme').innerHTML = marked.parse(text);
    } else {
      document.getElementById('d-readme').innerHTML =
        `<p style="color:var(--muted)">No README. <a href="${GH_TREE(t.id)}" target="_blank">View on GitHub</a></p>`;
    }

  } catch {
    document.getElementById('d-actions').innerHTML =
      `<a class="btn btn-p" href="${GH_TREE(t.id)}" target="_blank" rel="noopener">View on GitHub</a>`;
    document.getElementById('d-readme').innerHTML =
      `<p style="color:var(--muted)">Failed to load content.</p>`;
  }
}

function closeDetail() {
  detail.classList.remove('open');
  listView.style.display = '';
}

document.getElementById('back').addEventListener('click', closeDetail);
document.addEventListener('keydown', e => {
  if (e.key === 'Escape' && detail.classList.contains('open')) closeDetail();
});

load();
</script>
</body>
</html>
